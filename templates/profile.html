{% extends "base.html" %}
{% block content %}

<div class="page-header">
    <div class="page-title-row">
        <div class="vault-title-wrap">
            <span class="vault-big-icon" style="background: rgba(79,70,229,0.1); color: var(--accent); font-size:22px;">ğŸ‘¤</span>
            <div>
                <h1 class="page-title">{{ current_user.username }}</h1>
                <p class="page-meta">
                    Ğ Ğ¾Ğ»ÑŒ: {{ current_user.role.name if current_user.role else 'â€”' }} Â·
                    Ğ“Ñ€ÑƒĞ¿Ğ¿Ñ‹: {{ current_user.groups | map(attribute='name') | join(', ') or 'â€”' }}
                </p>
            </div>
        </div>
    </div>
</div>

<div class="content-area" style="max-width:700px; gap:20px;">

    <!-- Change password -->
    <div class="admin-card">
        <h3 style="font-size:15px; font-weight:700; margin-bottom:18px;">ğŸ”’ Ğ¡Ğ¼ĞµĞ½Ğ° Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ</h3>
        <form method="POST" action="{{ url_for('profile') }}">
            <div class="form-group">
                <label>Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ</label>
                <div class="input-eye-wrap">
                    <input type="password" name="current_password" id="curPass" placeholder="Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ" required>
                    <button type="button" class="eye-btn" onclick="togglePass('curPass', this)">ğŸ‘</button>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ</label>
                    <div class="input-eye-wrap">
                        <input type="password" name="new_password" id="newPass" placeholder="ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 6 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²" required>
                        <button type="button" class="eye-btn" onclick="togglePass('newPass', this)">ğŸ‘</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ</label>
                    <div class="input-eye-wrap">
                        <input type="password" name="confirm_password" id="confPass" placeholder="ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ" required>
                        <button type="button" class="eye-btn" onclick="togglePass('confPass', this)">ğŸ‘</button>
                    </div>
                </div>
            </div>
            <div class="strength-bar"><div class="strength-fill" id="strengthFill"></div></div>
            <div class="strength-label" id="strengthLabel" style="margin-bottom:14px;"></div>
            <button type="submit" class="btn-primary">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
        </form>
    </div>

    <!-- Activity log -->
    <div class="admin-card">
        <h3 style="font-size:15px; font-weight:700; margin-bottom:18px;">ğŸ“‹ ĞœĞ¾Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ</h3>
        {% if logs %}
        <div class="audit-log-list">
            {% for log in logs %}
            <div class="audit-item">
                <span class="audit-icon">{{ {'view_container':'ğŸ‘','create_password':'â•','edit_password':'âœï¸','delete_password':'ğŸ—‘','view_password':'ğŸ”','grant_access':'ğŸ”‘','revoke_access':'ğŸš«','create_container':'ğŸ“'}.get(log.action, 'â€¢') }}</span>
                <div class="audit-body">
                    <span class="audit-action">{{ log.details or log.action }}</span>
                </div>
                <span class="audit-time">{{ log.timestamp.strftime('%d.%m.%Y %H:%M') }}</span>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p style="color:var(--text-muted); font-size:13px;">ĞĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸</p>
        {% endif %}
    </div>
</div>

<script>
function togglePass(id, btn) {
    const el = document.getElementById(id);
    el.type = el.type === 'password' ? 'text' : 'password';
    btn.textContent = el.type === 'password' ? 'ğŸ‘' : 'ğŸ™ˆ';
}
document.getElementById('newPass').addEventListener('input', function() {
    const val = this.value;
    let score = 0;
    if (val.length >= 8) score++;
    if (/[A-Z]/.test(val)) score++;
    if (/[0-9]/.test(val)) score++;
    if (/[^A-Za-z0-9]/.test(val)) score++;
    const fill = document.getElementById('strengthFill');
    const label = document.getElementById('strengthLabel');
    const colors = ['#ef4444','#f59e0b','#6366f1','#10b981'];
    const labels = ['Ğ¡Ğ»Ğ°Ğ±Ñ‹Ğ¹','Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹','Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¸Ğ¹','Ğ¡Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹'];
    fill.style.width = (score * 25) + '%';
    fill.style.background = colors[score - 1] || '#333';
    label.textContent = val ? labels[score - 1] || '' : '';
    label.style.color = colors[score - 1] || '#999';
});
</script>
{% endblock %}
