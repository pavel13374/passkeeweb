<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vault ‚Äî –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–∞—Ä–æ–ª–µ–π</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
{% block body %}
<div class="app-shell">

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <span class="logo-icon">‚¨°</span>
                <span class="logo-text">VAULT</span>
            </div>
            <a href="{{ url_for('profile') }}" class="user-chip" title="–ü—Ä–æ—Ñ–∏–ª—å / –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å">
                <span class="user-avatar">{{ current_user.username[0].upper() }}</span>
                <div class="user-info">
                    <span class="user-name">{{ current_user.username }}</span>
                    <span class="user-role">{{ current_user.role.name if current_user.role else 'no role' }}</span>
                </div>
            </a>
        </div>

        <nav class="sidebar-nav">
            <a href="{{ url_for('dashboard') }}" class="nav-item {% if not current_container and request.endpoint != 'admin_panel' %}active{% endif %}">
                <span class="nav-icon">‚óà</span>
                <span>–í—Å–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞</span>
            </a>
            {% if current_user.is_admin() %}
            <a href="{{ url_for('admin_panel') }}" class="nav-item {% if request.endpoint == 'admin_panel' %}active{% endif %}">
                <span class="nav-icon">‚öô</span>
                <span>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
            </a>
            {% endif %}
        </nav>

        <div class="sidebar-section-title">–ú–æ–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞</div>
        <div class="containers-list">
            {% for container in containers %}
            <a href="{{ url_for('open_container', container_id=container.id) }}"
               class="container-item {% if current_container and current_container.id == container.id %}active{% endif %}"
               style="--accent: {{ container.color }}">
                <span class="container-icon">{{ container.icon }}</span>
                <span class="container-name">{{ container.name }}</span>
                <span class="container-count">{{ container.passwords|length }}</span>
            </a>
            {% endfor %}
        </div>

        {% if shared_containers %}
        <div class="sidebar-section-title" style="margin-top:8px;">–û–±—â–∏–µ</div>
        <div class="containers-list">
            {% for container in shared_containers %}
            <a href="{{ url_for('open_container', container_id=container.id) }}"
               class="container-item shared {% if current_container and current_container.id == container.id %}active{% endif %}"
               style="--accent: {{ container.color }}">
                <span class="container-icon">{{ container.icon }}</span>
                <span class="container-name">{{ container.name }}</span>
                <span class="container-badge">shared</span>
            </a>
            {% endfor %}
        </div>
        {% endif %}

        <button class="btn-new-vault" onclick="openVaultModal()">
            <span>+</span> –ù–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
        </button>

        <a href="{{ url_for('logout') }}" class="logout-btn">
            <span>‚Ü©</span> –í—ã–π—Ç–∏
        </a>
    </aside>

    <!-- MAIN -->
    <main class="main-content">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="flash-container">
            {% for category, message in messages %}
            <div class="flash flash-{{ category }}">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>
</div>

<!-- CREATE VAULT MODAL -->
<div id="vaultModal" class="modal-overlay" onclick="closeVaultModal(event)">
    <div class="modal-box">
        <div class="modal-header">
            <h3>–ù–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ</h3>
            <button class="modal-close" onclick="closeVaultModal()">‚úï</button>
        </div>
        <form method="POST" action="{{ url_for('create_container') }}">
            {% if current_container %}
            <input type="hidden" name="parent_id" value="{{ current_container.id }}">
            {% endif %}

            <div class="form-group">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                <input type="text" name="name" placeholder="–ú–æ—ë —Ö—Ä–∞–Ω–∏–ª–∏—â–µ" required>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>–ò–∫–æ–Ω–∫–∞</label>
                    <div class="icon-picker">
                        {% for ico in ['üîê','üè¶','üíº','üõ°Ô∏è','üîë','üåê','üíª','üì±','üè†','‚ö°'] %}
                        <label class="icon-option">
                            <input type="radio" name="icon" value="{{ ico }}" {% if loop.first %}checked{% endif %}>
                            <span>{{ ico }}</span>
                        </label>
                        {% endfor %}
                    </div>
                </div>
                <div class="form-group">
                    <label>–¶–≤–µ—Ç</label>
                    <div class="color-picker">
                        {% for clr in ['#6366f1','#ec4899','#f59e0b','#10b981','#3b82f6','#ef4444','#8b5cf6','#06b6d4'] %}
                        <label class="color-option">
                            <input type="radio" name="color" value="{{ clr }}" {% if loop.first %}checked{% endif %}>
                            <span style="background: {{ clr }}"></span>
                        </label>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn-ghost" onclick="closeVaultModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn-primary">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </form>
    </div>
</div>

<script>
function openVaultModal() {
    document.getElementById('vaultModal').classList.add('active');
}
function closeVaultModal(e) {
    if (!e || e.target.id === 'vaultModal' || e.currentTarget.classList?.contains('modal-close') || e.currentTarget.classList?.contains('btn-ghost')) {
        document.getElementById('vaultModal').classList.remove('active');
    }
}
document.querySelectorAll('.flash').forEach(el => {
    setTimeout(() => el.classList.add('fade-out'), 3000);
});
</script>
{% endblock %}
</body>
</html>